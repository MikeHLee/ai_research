## Optimization-based Learning for Outbound Load Planning in Parcel Delivery Service Networks

Ritesh Ojha _[a]_, Wenbo Chen _[a]_, Hanyu Zhang _[a]_, Reem Khir _[b]_, Alan Erera _[a]_, Pascal Van Hentenryck _[a]_


_a_ H. Milton Stewart School of Industrial and Systems Engineering, Georgia Tech, Atlanta, GA


_b_ School of Industrial Engineering, Purdue University, West Lafayette, IN


{rojha8, wenbo.chen, hzhang747}@gatech.edu, {rkhir}@purdue.edu, {alan.erera, pvh}@isye.gatech.edu


**Abstract**


_The load planning problem is a critical challenge in service network design for parcel carriers: it decides how many_


_trailers (or loads), perhaps of different types, to assign for dispatch over time between pairs of terminals. Another_


_key challenge is to determine a flow plan, which specifies how parcel volumes are assigned to planned loads. This_


_paper considers the Outbound Load Planning Problem (OLPP) that considers flow and load planning challenges_


_jointly in order to adjust loads and flows as the demand forecast changes over time before the day of operations in a_


_terminal. The paper aims at developing a decision-support tool to inform planners making these decisions at terminals_


_across the network. The paper formulates the OLPP as a mixed-integer programming (MIP) model and shows that it_


_admits a large number of symmetries in a network where each commodity can be routed through primary and alternate_


_terminals. As a result, an optimization solver may return fundamentally different solutions to closely related problems_


_(i.e., OLPPs with slightly different inputs), confusing planners and reducing trust in optimization. To remedy this_


_limitation, the first contribution of the paper is to propose a lexicographical optimization approach that eliminates_


_those symmetries by generating optimal solutions staying close to a reference plan. The second contribution of the_


_paper is the design of an optimization proxy that addresses the computational challenges of the optimization model._


_The optimization proxy combines a machine-learning model and a MIP-based repair procedure to find near-optimal_


_solutions that satisfy real-time constraints imposed by planners in the loop. An extensive computational study_


_on industrial instances shows that the optimization proxy is around_ 10 _times faster than the commercial solver_


_in obtaining solutions of similar quality; the optimization proxy is also orders of magnitude faster for generating_


_solutions that are consistent with each other. The proposed approach also demonstrates the benefits of the OLPP for_


_load consolidation and the significant savings obtained from combining machine learning and optimization._

### **1 Introduction**


Much of e-commerce relies on the home delivery of small parcels and other boxed freight. Leading analysts


project that today’s $3.3 trillion e-commerce market could grow further to $5.4 trillion annually by 2026


1


(Stanley, 2022). This has led key freight carriers like UPS and FedEx to continuously seek to redesign


and operate profitable logistic networks that meet e-commerce customer expectations. As a result, these


companies need to solve a number of strategic, tactical, and operational optimization problems. For instance,


at the strategic level, the _physical network design_ must determine optimal locations and sizes of various


freight processing terminals (also known as sorting facilities). At the tactical level, the _load planning_ must


determine the number of trailers and their types (also known as _loads_ ) to dispatch over time between pairs


of terminals. The resulting load plan defines the transportation capacity of the network. In addition, at


the tactical level, the _flow planning_ must determine how to allocate package volumes to loads or trailers


to serve the network demand effectively. When moving from its origin to its destination, each package


is transported by a sequence of trailers, and it gets unloaded, sorted, and loaded at each terminal while


moving between these trailers. These sequences of trailers define the _primary (flow) path_ for each package.


Together, the flow and load plans define a service network that moves packages from origins to destinations


to meet customer service expectations.


Tactical flow and load plans are typically generated from _average_ daily estimates of origin-destination


package volume. However, in practice, package volumes may substantially change from day to day and


week to week (Lindsey et al., 2016). Thus, plans based on average flows may perform poorly during actual


operations and, in some cases, may even become infeasible. To address this issue, planners take advantage


of _alternate paths_ for packages, i.e., they reroute packages from primary paths to other paths that allow


for better consolidation while maintaining service guarantees. Such adjustments are typically performed


manually: planners use the latest available estimates on package volumes at their terminals along with their


experience to modify existing flow and load plans. _The goal of this paper is to propose a systematic and effective_


_framework to plan adjustments at a terminal_ . The proposed framework automates current manual processes,


significantly reducing the time planners spend on reviewing and finalizing plans while bridging the gap


between _tactical flow and load planning_ and _operational execution_ for improved performance. [1]


To the best of our knowledge, this paper proposes, for the first time, an optimization-based learning


tool that is capable of generating, _in a few seconds_, near-optimal adjusted load plans for a given terminal.


The proposed approach can be leveraged as part of a more complex framework to coordinate load plan


adjustments across a cluster of terminals or an entire network. More precisely, this paper defines the


_Outbound Load Planning Problem_ (OLPP) whose goal is to minimize the total trailer capacity required to


accommodate the estimated package volume leaving a terminal. This OLPP decides (1) the number of


trailers and their types to be scheduled for outbound dispatch to other terminals at different time points


throughout the day of operations, and (2) the allocation of package volumes to available routing options


while respecting trailer capacity constraints. These two decisions define what is called a _load plan_ in this


1 Optimizing load plan adjustments at the network level, across all terminals simultaneously, is computationally challenging,
especially for the large-scale networks operated by our industry partner; those networks have thousands of terminals and move
millions of packages daily.


2


paper. The OLPP is strongly NP-hard and its Mixed Integer Programming (MIP) formulation, when


solved directly using a commercial solver, exhibits significant sensitivity to input data, which may result


in considerable variations in load planning decisions when commodity volume varies even slightly. This


makes the model, in its standard form, impractical for industrial use because a small change in package


volume may result in fundamentally different load plans, which is undesirable in a planner-in-the-loop


environment. It is also harder to execute given drivers availability, equipment positioning, and other


practical considerations. To address these challenges, the paper presents an optimization-based learning


framework that delivers high-quality, stable, and feasible solutions to OLPP in a few seconds, even for the


largest terminals in one of the largest parcel delivery service networks operated in the United States. The


proposed methodology consists of two critical steps: (1) the derivation of a new _lexicographic optimization_


model that delivers _stable_ optimal solutions; (2) an _optimization proxy_ that delivers near-optimal solution to


the optimization model in a few seconds.


The main _methodological and business contributions_ of the paper can be summarized as follows:


1. The paper proposes the Lexicographic Outbound Load Planning Problem (LOLPP) to remedy the


limitations of the standard MIP formulation of OLPP. The LOLPP eliminates symmetries and provides


stable optimal load plans that are as close as possible to a pre-determined reference plan.


2. The paper proposes an optimization proxy to address the computational difficulties of the LOLPP. The


optimization proxy uses a _machine learning model_ to predict the number of trailers to dispatch for each


outbound terminal and _a repair procedure_ that adjusts the predictions to satisfy the problem constraints


and determine the package volume allocation to primary and alternate routing options. Once trained,


the optimization proxy can be leveraged in an online setting to provide high-quality solutions in a few


seconds.


3. The paper presents an extensive computational study on industrial instances, including some of the


largest terminals in a large-scale parcel delivery network. The results show that the optimization


proxy significantly outperforms a greedy heuristic and the MIP formulation both in terms of the


objective function value and _consistency_ metrics. The optimization proxy is around 10 times faster


than the commercial solver in obtaining solutions with the same objective function value and orders


of magnitude faster in terms of generating solutions that are consistent with a reference plan. The


experimental results also show the value of breaking symmetries in learning accurate solution patterns


and producing high-quality and stable load plans. The efficiency of the proposed approach makes it


practical for real-time load plan adjustments.


4. From a business and sustainability perspective, the experiments demonstrate the value of having


alternate routing options for the commodities in addition to the primary routing options. The proposed


3


load plans allocate approximately 17% package volume to the alternate routing options and reduce


the required trailer capacity by 12% _−_ 15%.


The remainder of this paper is organized as follows. Section 2 summarizes related work. Section 3 presents


a high-level description of the OLPP and its MIP formulation, and highlights the operational planning


realities in load planning. Section 4 presents a MIP formulation with a lexicographic objective function


to remedy the limitations of the MIP formulation of OLPP. Section 5 describes the optimization proxies.


Section 6 describes a heuristic that mimics human planners and is used to benchmark the feasible solution


obtained by the optimization proxy. Section 7 describes the computational results. Section 8 discusses the


benefits of optimization and machine learning, quantifying the cost and sustainability benefits and the


important factors driving them. Finally, Section 9 finishes with conclusion and discusses future research


directions.

### **2 Related Work**


Transportation operations in parcel service networks are similar to operations in the _Less-than-truckload_


(LTL) industry (Hewitt, 2019). In the LTL trucking industry, decisions have to be made at strategic,


tactical, and operational levels (Crainic & Laporte, 1997). Much of the related literature focuses on service


network design (SND) problems, where different problems were classified as SND problems including


flow planning problems, load planning problems, routing and dispatching problems, driver and fleet


management problems, and vehicle routing and scheduling problems (Bakir et al., 2021). We focus our


attention on the first two problems given their direct relevance to the OLPP presented in this work.


Bakir et al., 2021 describe the tactical _flow and load planning problem_ and present a detailed summary of


the mathematical models and heuristics used to solve the problem as found in the literature. The goal of a


flow and load planning problem is to determine a cost-effective primary path for each package and the


total trailer capacity required on each transportation arc in the service network. Most of these problems


are formulated over time-space networks using integer programming models. Exact approaches to solve


these problems have been proposed by Boland et al., 2017, Marshall et al., 2021, and Hewitt, 2019. However,


these approaches can only solve instances with a few thousand of packages. For industry-scale instances,


researchers have resorted to various heuristics, including variants of local search heuristic algorithms (Erera


et al., 2013; Lindsey et al., 2016; Powell, 1986), and greedy algorithms (Ulch, 2022).


Traditional flow and load planning problems generate a single, primary (flow) path for each package.


Baubaid et al., 2021 study the value of having alternate paths to hedge against demand uncertainty. More


specifically, the authors study the decisions that _LTL_ carriers need to make, in an operational setting, to


effectively operate a _p_ _−_ alt load plan when demand changes dynamically on a day-to-day basis. The authors


4


show that it is sufficient to have just one alternate option to contain the impact of most of the fluctuations


_−_
in demand; such a load plan is referred to as a 2 alt load plan. In a follow up work, Baubaid et al., 2023


study a dynamic freight routing problem and propose an offline-online approximate dynamic programming


solution approach for the problem. Given a specific number of shipments or pallets at a terminal in a


decision epoch, the key decision in their problem is to decide the (unsplittable) routing of each shipment to


a primary _or_ an alternate arc. Along similar lines, Herszterg et al., 2022 introduce the problem of re-routing


freight volume on alternate paths to improve the on-time performance of load plans on the day of operations;


this becomes necessary when the actual volume deviates from the forecasted volume. In this work, package


volume is unsplittable and is assigned to exactly one path such that the total (fixed) trailer capacity on


each arc is respected while minimizing total shipment tardiness. The authors formulate the problem as a


MIP model and propose heuristic algorithms to solve it. It is important to note that the problem described


in both Baubaid et al., 2023 and Herszterg et al., 2022 considers a network of terminals and fixed trailer


capacity between any pair of terminals in the network. In our problem setting, we consider outbound


operations from a single terminal and have the flexibility to change the outbound trailer capacity to one


or more destinations from the terminal if it leads to better consolidation while allowing volume splitting


across multiple routes. Specifically, this research bridges the gap between tactical flow and load planning


(Bakir et al., 2021) and operational execution (Baubaid et al., 2023; Herszterg et al., 2022). The goal here


is to efficiently and effectively adjust the existing load plan as more accurate package volume forecast is


available; this problem is mentioned as an interesting and useful future research direction by Lindsey et al.,


2016. The flexibility to adjust the load plans enables terminal planners to better manage daily operations


while maintaining service guarantees.


From a methodological perspective, we propose an optimization-based learning framework that can


generate near-optimal and implementable solutions even for the largest terminal in a few seconds. In


recent years, there has been a notable surge of interest among researchers in the development of machine


learning (ML) surrogates for solving MIP models. This emerging field has attracted attention due to the


potential of ML techniques to provide efficient approximations for computationally intensive calculations


involved in solving MIPs. We refer the reader to (Bengio et al., 2021; Kotary, Fioretto, Van Hentenryck,


and Wilder, 2021) for a comprehensive overview on the topic. The techniques can fall into one of the two


categories. The first category includes methods based on reinforcement learning (Fu et al., 2021; Khalil et al.,


2017; Kool et al., 2018; Song et al., 2022; Yuan et al., 2022), where the ML model is trained by interacting


with simulation environments. The second category comprises supervised learning (Chen et al., 2023;


Fioretto et al., 2020; Kotary, Fioretto, and Van Hentenryck, 2021; Kotary et al., 2022; Park et al., 2022),


where the ML model imitates the optimization model and replaces expensive calculations with a quick


approximation. This research focuses on the latter category since the proposed optimization model could


be used as the expert for supervised learning; we refer to this optimization-based learning methodology


5


as the optimization proxies. Optimization proxies, which combine learning with feasibility restoration,


have emerged from supervised learning and have been used in various application areas including energy


systems and scheduling operations (Chen et al., 2023, 2024; Kotary et al., 2022; Park et al., 2022). This paper


adds to this stream of research and shows the potential of optimization proxies in solving logistics and


transportation problems.

### **3 The Outbound Load Planning Problem (OLPP)**


This section presents a high-level problem description of the standard OLPP problem. It then introduces a


MIP formulation and discusses planning realities in the field and the related practical challenges.


**3.1** **High-Level Problem Description**


This research is conducted with a leading global parcel carrier that operates a massive network of more than


one thousand terminals and processes millions of packages daily. As the size and volume of the packages


can be very small compared to the capacity of a trailer, parcel carriers seek to consolidate packages from


different customers using terminals in their parcel service network (PSN). In a PSN, packages move from


one terminal to another until they reach their final destination. At a specific terminal, a package has a set of


outbound terminals that it can be routed to while meeting its service expectations; the set of such outbound


terminals is determined a _priori_, in a strategic planning phase at the network level, to ensure that each


package reaches its destination in timely manner. To facilitate consolidation, parcel carriers group packages


arriving at a terminal on a particular day into a set of commodities, where a commodity is a grouping of


packages sharing the same service class (e.g., one-day service or two-day service), and the same destination.


Each commodity has a specific volume and that volume can be split into different quantities that can be


sent along to different outbound terminals.


This paper considers the _Outbound Load Planning Problem_ (OLPP) for a single terminal in a PSN. The


OLPP receives a set of commodities as input and its goal is to design a load plan for the day by determining


how many trailers are sent to each outbound terminal, and how the volume of each commodity is split


across these outbound terminals. The OLPP objective is to minimize trailer costs (a proxy for minimizing


operational cost), while ensuring that sufficient trailer capacity is installed to accommodate the volume of


all commodities. Note that existing load planning literature typically assumes that _all_ commodities arriving


at a terminal should be assigned to a single outbound terminal, that is, splitting is not allowed. The OLPP


considered in this paper is different: it determines how to split each commodity volume across its outbound


terminals to minimize trailer costs.


In practice, the problem is slightly more involved since each day at a terminal is divided into time


6


windows (typically three to four hours in length), called _sort periods_ or _sorts_, during which packages


are sorted. A typical operational day includes “day”, “twilight”, “night” and “sunrise” sorts that are


non-overlapping in time. The OLPP must be executed for multiple sorts at a terminal and the concept


of outbound terminal is replaced by a pair (terminal, sort). The generalization of the OLPP to this more


complex setting is discussed in Appendix 10.1.


**3.2** **Problem Formulation**


This section presents the OLPP model. Let _A_ denote the set of outbound terminals from a given terminal


_O_ . Let _K_ denote the set of commodities to be sorted at terminal _O_ . Each commodity _k_ _∈_ _K_ has a cubic

volume of _q_ _[k]_ and a set of outbound terminals _A_ _[k]_ _⊆_ _A_ that defines the next _service-feasible_ terminals for the


commodity; if a commodity is routed to a service-feasible outbound terminal, then it reaches its destination


on time. The total commodity volume allocated to outbound terminal _a_ _∈_ _A_ can be loaded into a set of


trailer types _V_ _a_ where each trailer type _v_ _∈_ _V_ _a_ has a cubic capacity _Q_ _v_, and a per-unit transportation cost _c_ _v_ .


Each outbound terminal can have a different set of allowed trailer types, i.e., _V_ _a_ 1 can be different from _V_ _a_ 2


for two different outbound terminals _a_ 1, _a_ 2 _∈_ _A_ . A solution of the OLPP determines the number of trailers


of each type assigned to each outbound terminal and the volume of each commodity allocated to a trailer


type for these outbound terminals. A solution must ensure that all the volume is assigned to trailers and


that the trailer capacities are not exceeded. The objective of the OLPP is to find a solution that minimizes


total trailers’ cost.


A Mixed-Integer Programming (MIP) model for the OLPP can be stated as follows:

### Minimize x, y a ∑ ∈ A v [∑] ∈ V a c v y a, v (1a) subject to ∑ x [k] a, v [=] [ q] [k] [,] ∀ k ∈ K, (1b) a ∈ A [k] [ ∑] v ∈ V a ∑ x [k] a, v [≤] [Q] [v] [y] [a] [,] [v] [,] ∀ a ∈ A, v ∈ V a, (1c)

_k_ _∈_ _K_ : _a_ _∈_ _A_ _[k]_


_x_ _[k]_ _a_, _v_ _[≥]_ [0] _∀_ _k_ _∈_ _K_, _a_ _∈_ _A_ _[k]_, _v_ _∈_ _V_ _a_, (1d)


_y_ _a_, _v_ _∈_ **Z** _≥_ 0 _∀_ _a_ _∈_ _A_, _v_ _∈_ _V_ . (1e)


It uses a non-negative continuous decision variable _x_ _[k]_ _a_, _v_ [to represent the volume of commodity] _[ k]_ _[ ∈]_ _[K]_

allocated to trailer type _v_ _∈_ _V_ _a_ planned for outbound terminal _a_ _∈_ _A_ _[k]_, and an integer decision variable


_y_ _a_, _v_ to determine the number of trailers of type _v_ planned for outbound terminal _a_ _∈_ _A_ . The experiments


use _c_ _v_ = _Q_ _v_ _∀_ _v_ _∈_ _V_ in the objective (1a), i.e., the model minimizes the total trailer capacity required


to accommodate the commodity volume. Constraints (1b) ensure that the volume of each commodity is


7


assigned to outbound terminals. Constraints (1c) ensure that the total volume allocated to an outbound


                                                              terminal respects the installed trailer capacity associated with the terminal. Constraints (1d) (1e) define the


domain and range of variables.


It is worth noting that OLPP is conceptually related to the variable-sized bin-packing problem described


by Friesen and Langston, 1986, where the objective is to minimize the total space used to pack a set of items


into bins (available in different sizes), such that each item is packed into exactly one bin. In the OLPP, the


packages are the items and trailers are bins; The key difference is that the OLPP allows for the _splitting_


of the package volume across multiple trailers (determined by the primary and alternate terminals); this


makes it possible to reduce the transportation cost by promoting better consolidation or packing.


Appendix 10.2 includes complexity results and related proofs for the OLPP problem. The OLPP, in its


general form, is strongly NP-hard. It becomes weakly NP-hard when each commodity is compatible with


exactly one or all outbound terminals, and there are multiple trailer types. It becomes polynomial when


each commodity is compatible with exactly one or with all outbound terminals, and there is only one trailer


type.


**3.3** **Planning Realities in the Field**


The OLPP model presented in the previous section is idealized. This section reviews planning realities in


the field, which require generalizations of the OLPP.


**Primary and Alternate Routing Options** Parcel carriers typically identify a set of outbound terminals for


each commodity processed at the current terminal; the preferred option is the _primary_ outbound terminal


and the other options are referred to as _alternate_ outbound terminals. The choice of the alternate terminals


is usually determined after identifying the primary terminals, typically using historical data and past


experiences (Baubaid et al., 2021). It is desirable for a practical OLPP model to send commodities to their


primary outbound terminal as much as possible, while using alternate terminals as opportunities for better


consolidations. Figure 1 illustrates the concepts of primary and alternate terminals. Recall that the primary


and alternate outbound terminals for each commodity are defined in such a way that the commodities


allocated to these routing options reach their destination on time.


**Planners in the Loop** This research is conducted with a leading global parcel carrier, with planners in the


loop in most terminals. The OLPP is solved periodically over a period going from the two weeks prior to


the day of operations to the day of operations. For each time period, each terminal in the network has a set


of forecasted inbound commodities. The role of the planners is to adjust an existing flow and load plan to


accommodate the changes in forecasted inbound commodities. When automating the planning process with


8


E, Day 2


**Figure 1:** _The primary terminal for commodities processed at terminal A and destined for terminal D on day_ 4 _is denoted by solid_
_green arc and the two alternate terminals are denoted by solid blue and solid brown arcs._









|𝑞!|Col2|Col3|
|---|---|---|
|𝑞! !∈#|||
||||


A, Day 1


|𝑞!|Col2|Col3|
|---|---|---|
|𝑞! !∈#|||
||||









A, Day 1





E, Day 2


**(a)**



E, Day 2


**(b)**



E, Day 2


**(c)**



**Figure 2:** _An example to highlight the alternate (symmetric) optimal solutions for OLPP (Model 1)._


optimization and/or machine learning, it is thus critical to present planners with plans that are consistent


over time as much as possible.


Unfortunately, the OLPP model exhibits a large number of variable symmetries, i.e., the values of several


variables can be permuted to obtain another optimal solution. Consider the example shown in Figure


2 that illustrates a _primary terminal_ ( _C_, _Day_ 2 ), an alternate terminal ( _B_, _Day_ 3 ), and an alternate terminal


( _E_, _Day_ 2 ) for a set of commodities _K_ processed at terminal A on day 1 and destined for terminal D on day


4. Figure 2 depicts a simple instance with symmetric solutions that are operationally different from one


another, yet they are equivalent, from the OLPP Model (1) perspective, as they require the same number of


trailers of the same type, and hence the same total trailer capacity. The values of the _y_ variables for each


outbound terminal in Figure 2a can be permuted to get the solution in Figures 2b and 2c without changing


the problem structure. The alternate optimal solutions exist in the OLPP Model (1) because commodities are


indifferent to the primary and alternate terminals they are assigned to, as the volume allocation decisions ( _x_


variables) do not incur any cost.


Such symmetries are undesirable for many reasons. Paramount among them are the realities in the field:


the model is intended to be used and validated by planners. Furthermore, the OLPP is sensitive to minor


changes in input data (commodity volume). If small or no variations of total commodity volume produce


9


fundamentally different solutions, planners are unlikely to trust the model. Indeed, since the model is used


multiple times during the day, it is important to ensure that successive optimal solutions are as consistent


with each other as possible. For the example shown in Figure 2a, consider two instances with commodity


volume _ϕ_ 1 at time _t_ 1 and commodity volume _ϕ_ 2 = _ϕ_ 1 + _ϵ_ at time _t_ 2 . If both instances have optimal solution


with three trailers, it is desirable that they would allocate trailers similarly. However, the OLPP model,


when solved by a commercial solver, does not guarantee this, highlighting the sensitivity of the model to


input data.

### **4 The Lexicographic Outbound Load Planning Problem (LOLPP)**


This section presents the Lexicographic Outbound Load Planning Problem (LOLPP) designed to account for


the realities in the field. The LOLPP uses a lexicographic objective function to produce stable plans and


break symmetries, while optimizing for total trailer capacity. The LOLPP is represented by Model 2:

### Lex-Minimize x, y ⟨ a ∑ ∈ A v [∑] ∈ V a c v y a, v, ∑ a ∈ A v [∑] ∈ V a | y a, v − γ a, v |, ∑ k ∈ K a ∈ [∑] A k v [∑] ∈ V a d [k] a [x] [k] a, v [⟩] (2a) subject to ∑ x [k] a, v [=] [ q] [k] [,] ∀ k ∈ K, (2b) a ∈ A [k] [ ∑] v ∈ V a ∑ x [k] a, v [≤] [Q] [v] [(] [y] [a] [,] [v] [)] [,] ∀ a ∈ A, v ∈ V a, (2c)

_k_ _∈_ _K_ : _a_ _∈_ _A_ _[k]_


_x_ _[k]_ _a_, _v_ _[≥]_ [0] _∀_ _k_ _∈_ _K_, _a_ _∈_ _A_ _[k]_, _v_ _∈_ _V_ _a_, (2d)


_y_ _a_, _v_ _∈_ **Z** _≥_ 0 _∀_ _a_ _∈_ _A_, _v_ _∈_ _V_ . (2e)


Model 2 receives two key inputs: (1) a _reference plan_ _γ_, i.e., the last available tactical outbound load plan


for the terminal under consideration that specifies the number of trailers of different types planned to


operate for each outbound terminal; and (2) the costs of allocating commodity volume to its primary and/or


alternate terminals. Its objective function leverages these two inputs to account for the realities in the field.


More precisely, the objective function (2a) is lexicographic and consists of three sub-objectives that are


optimized in sequence.


The first sub-objective is the objective of the OLPP: it minimizes the total trailer cost. The second


sub-objective minimizes the deviation of the solution from the reference plan _γ_ . The third sub-objective


minimizes the _flow diversion cost_ . In the second sub-objective, _γ_ _a_, _v_ denotes the total number of trailers of


type _v_ _∈_ _V_ _a_ assigned to terminal _a_ _∈_ _A_ in the reference plan; the goal is to minimize the L1-norm between

the solution _y_ and _γ_ . In the third sub-objective, _d_ _[k]_ _a_ [denotes the cost of allocating a unit of commodity]

_k_ _∈_ _K_ to a terminal _a_ _∈_ _A_ _[k]_ ; recall that _A_ _[k]_ denotes the set of primary and alternate outbound terminals


for commodity _k_ _∈_ _K_ . The allocation cost to the primary outbound terminal is zero, as it represents the


10


|Col1|Col2|Col3|Col4|Col5|Col6|Col7|
|---|---|---|---|---|---|---|
|||~~OLPP~~<br>LOLPP|||||
|||LOLPP<br>2|||||
||||||||
||||||||
||||||||
||||||||


**(a)** _Outbound Terminal 1_




|Col1|Col2|Col3|Col4|Col5|Col6|
|---|---|---|---|---|---|
|||||||
|||||||
|||||||
|||||||
|||||||
|||||||



**(b)** _Outbound Terminal 2_



**Figure 3:** _(color online) Sensitivity analysis of the OLPP, LOLPP, and LOLPP_ _[−]_ [2] _on a real-world medium-sized instance from our_
_industry partner._


desired routing option. The cost of allocating a commodity volume to an alternate terminal is proportional


to the distance between the alternate terminal and the final commodity destination, since it is preferable to


route commodities as close as possible to their ultimate destination. The purpose of this diversion cost is to


break symmetries between solutions with the same distance to the reference plan. For instance, it breaks the

symmetries in Figure 2, as the cost _d_ _[k]_ _a_ [is different for different outbound terminals] _[ a]_ [ for a given commodity]


_k_ . Note also that constraints (2b), (2c), (2d) and (2e) are the same as in the OLPP Model (1).


The LOLPP uses the second and the third sub-objectives to account for some of the network effects, so


that the generated load plans are not completely myopic in nature. Note that the reference plan _γ_ for a


given terminal is derived from a tactical load plan developed at the network level. Therefore, the second


sub-objective ensures that the optimized load plan for the terminal does not deviate significantly from the


network-level load plan. Furthermore, if it becomes necessary to allocate the volume of a commodity to


an alternate outbound terminal, then the flow diversion cost (third sub-objective) prioritizes the alternate


terminals that are closer to the final destination as opposed to choosing the nearest alternate outbound


terminal, which can be a myopic decision.


Figure 3 shows the benefits of the LOLPP: it illustrates the sensitivity of the trailer decisions, i.e., the

values of _y_ -variables for some individual outbound terminals when the total commodity volume ∑ _k_ _∈_ _K_ _q_ _[k]_


varies. The vertical axis denotes the number of trailers of a specific type used for a specific outbound


terminal, and the horizontal axis denotes the total commodity volume. The red plot represents decisions


from solving the OLPP Model (1), the orange plot represents decisions of the LOLPP Model (2), and the


blue plot represents decisions of the LOLPP without the second sub-objective LOLPP _[−]_ [2] .


In the illustrated examples, as the total commodity volume increases, the OLPP model produces solutions


where the trailer decisions fluctuate dramatically between 1 and 6 trailers for outbound terminal 1 and


11


between 1 and 5 trailers for outbound terminal 2. The trailer decisions of the LOLPP model are more


consistent, and vary between 1 and 2 trailers for outbound terminal 1, and is constant at 2 trailers for


outbound terminal 2. When the second sub-objective is dropped, the trailer decisions vary between 1 and 3


for both outbound terminals, showing the effectiveness of the symmetry-breaking approach. It is worth


noting that, in the OLPP, the _total_ trailer capacity is a non-decreasing function of the total commodity


volume. However, the total trailer capacity planned for _an outbound terminal_ may increase or decrease when


the total commodity volume increases, as seen in Figure 3.

### **5 Learning the LOLPP**


The LOLPP model is typically too slow to be of practical use in real-time environments with planners in the


loop. This section proposes an optimization-based ML approach to address these computational limitations.


**5.1** **The Overall Approach**


The LOLPP can be viewed as a function _f_ that, given a vector of commodities **q**, returns an optimal solution


( **y** _[∗]_, **x** _[∗]_ ) specifying the load plan and the allocation of commodity volume to the primary and alternate

terminals, respectively. A corresponding machine learning model is a function _f_ [ˆ] that approximates _f_, i.e.,

_f_ ( **q** ) _≈_ _f_ [ˆ] ( **q** ) . More precisely, the machine learning model _f_ [ˆ], given the same vector of commodities **q**, should

return an approximate solution ( **y** ˆ, ˆ **x** ) such that ˆ _y_ _a_, _v_ _≈_ _y_ _[∗]_ _a_, _v_ [and] [ ˆ] _[x]_ _[k]_ _a_, _v_ _[≈]_ _[x]_ _[k]_ _a_, _[∗]_ _v_ [. However, such approximation]


does not guarantee the feasibility of generated solutions; the difficulty comes from the constraints of the


–
LOLPP, i.e., constraints (2b) (2c), which are highly likely to be violated by the machine learning model. In


other words, it is unlikely that ( **y** ˆ, ˆ **x** ) be a feasible solution to the LOLPP. This paper explores the concept of


_optimization proxy_ to remedy this issue and produce high-quality, feasible solutions for the LOLPP.


An optimization proxy is composed of a traditional machine learning model that produces an approxi

mate solution, say ( **y** ˆ, ˆ **x** ) in the LOLPP, and a repair layer that transforms the approximation into a feasible


solution, say ( **y** ¯, ¯ **x** ), of the LOLPP. See, for instance, Chatzos et al., 2022; Chen et al., 2022, 2023, 2024; Fioretto


et al., 2020; Kotary, Fioretto, and Van Hentenryck, 2021; Kotary et al., 2022; Park and Van Hentenryck, 2023;


Park et al., 2022; Van Hentenryck, n.d. for an overview of optimization proxies and their applications.


**5.2** **Optimization Proxies**


Figure 4 depicts the pipeline of the optimization-based learning approach used in this paper. At learning


time (offline), the approach generates a dataset of instances, i.e., mappings between inputs and outputs of


the LOLPP. These instances are used to train a machine learning model. At inference time (online) when


planners use the model, the machine learning model is used to obtain an approximated solution to an


12


**Figure 4:** _The Overall Pipeline of the Optimization-based Learning Approach: In the offline setting, the dataset is generated and_
_augmented by solving historical instances with the proposed LOLPP model. The ML model is trained in a supervised_
_learning fashion. In the online setting, the optimization proxies take as input a new instance and output a near-optimal_
_feasible load plan and commodity volume allocation plan in seconds._


unseen instance (i.e., a set of commodities for the LOLPP) which is then transformed into a feasible solution


by the repair layer, i.e., a feasible load plan and a commodity volume allocation plan for the LOLPP.


A simple way to obtain a feasible solution to LOLPP is to predict the commodity volume allocation ( ˆ _x_ )


variables and determine a corresponding feasible trailer decision ( ¯ _y_ ) variables as shown below



�



_y_ ¯ _a_, _v_ =



∑ _k_ _∈_ _K_ : _a_ _∈_ _A_ _k_ ˆ _x_ _[k]_ _a_, _v_
_Q_ _v_
�



_∀_ _a_ _∈_ _A_, _v_ _∈_ _V_ _a_ .



However, the feasible solution obtained from the approach can be rather poor in terms of the total trailer


capacity because the trailer decisions can be very sensitive to the predicted commodity volume allocation


decisions. Consider, for example, an optimal solution where 100 cubic volume is allocated to an outbound


terminal, which requires two trailers, each with a capacity of 50 units. If the machine learning model


100.5 =
predicts a volume of 100.5, then the total number of trailers required will be � 50 � 3, which generates a

poor solution of the LOLPP.


To remedy this problem, this paper focuses on a machine learning model that predicts the optimal


trailer decisions. The repair step then adjusts these trailer decisions to obtain a feasible solution to the


LOLPP, including the allocation decisions of commodity volume to their respective primary and/or alternate


outbound terminals.


13


Training









|%|×|'|

𝒚' ∈ℤ !"


Rounding



Volume of

commodities

𝐪∈ℝ +!𝟎











layer



**Figure 5:** _The Machine Learning Model for the LOLPP._


**5.3** **The Machine Learning Model**


This section presents the machine learning model that, given the commodity volumes, predicts the trailer

decisions for every outbound terminal. Consider a machine learning model _f_ [ˆ] _θ_, parameterized by _θ_, that


maps its inputs, i.e., the commodity volume, to the optimal trailer decisions: (3a)-(3b).


_f_ ˆ _θ_ : **R** _[|]_ _≥_ _[K]_ 0 _[|]_ _[−→]_ **[Z]** _[|]_ _≥_ _[A]_ 0 _[|×|]_ _[V]_ _[|]_ (3a)


**q** _�−→_ **y** (3b)


The machine learning model _f_ [ˆ] _θ_ is trained using a dataset of instances _{_ ( **q** _i_, **y** _i_ _[∗]_ [)] _[}]_ _[i]_ _[∈]_ _[N]_ [, where] _[ N]_ [ is the set]


of instances, **q** _i_ is the input of instance _i_, and **y** _i_ _[∗]_ [is the optimal trailer decision of instance] _[ i]_ [. The best]


parametrization _θ_ _[∗]_ can be obtained by minimizing the empirical risk


1
_θ_ _[∗]_ = argmin _θ_ _L_ ( _f_ [ˆ] _θ_ ( **q** _i_ ), **y** _i_ _[∗]_ [)] (4a)
### | N | i [∑] ∈ N


where _L_ is the loss function (e.g., the L1-distance between the predicted and optimal trailer decisions).


The machine learning model used in this paper is a deep neural network as illustrated in Figure 5.


It consists of a Multi-Layer Perceptron (MLP) and a series of operators such as reshaping, masking, and


rounding. The MLP comprises multiple layers, where each layer includes a dense perceptron, a batch


normalization (Ioffe and Szegedy, 2015), a dropout component (Srivastava et al., 2014), and a ReLU (Rectified


Linear Unit) activation function.


˜
The MLP maps the input parameter **q** to a non-negative trailer decision vector **y** [˜˜] with dimension

( _|_ _A_ _| × |_ _V_ _|_ ) . The reshaping operator converts the vector into a matrix **y** ˜ [˜] _∈_ **R** _[|]_ _≥_ _[A]_ 0 _[|×|]_ _[V]_ _[|]_, where entry _y_ ˜ [˜] _a_, _v_ could be


14


interpreted as the approximated number of trailers with equipment type _v_ _∈_ _V_ for outbound terminal _a_ _∈_ _A_ .


The masking operator sets the trailer decisions on the incompatible terminals to be zero by computing the


Hadamard product ˜ **y** = **y** ˜ [˜] _⊙_ **m**, where **m** denotes the binary compatibility matrix with _m_ _a_, _v_ = 1 indicating


that equipment type _v_ _∈_ _V_ is compatible with terminal _a_ _∈_ _A_ and _m_ _a_, _v_ = 0 otherwise.


The model is trained with a smoothed- _L_ 1 loss,

### L ( y ˜, y [∗] ) = a ∈ A ∑, v ∈ V 0.5 ( ˜ y a, v − y [∗] a, v [)] [2] [1] {| ˜ y a, v − y [∗] a, v |< 1 } [+ (] [|] [ ˜] [y] [a] [,] [v] [−] [y] [∗] a, v [| −] [0.5] [)] [1] {| ˜ y a, v − y [∗] a, v |≥ 1 } [,]


where **1** denotes the indicator function. The gradient of the loss is used to update the parameters of the


MLP using stochastic gradient descent (Kingma and Ba, 2014) with backpropagation (Rumelhart et al.,


1986). At inference time, the rounding operator ensures that the output trailer decisions are integers.


**5.4** **The Repair Procedure**


At inference time, the machine learning model produces an approximation to the number of trailers ˆ _y_ _a_, _v_


allocated to each outbound terminal _a_ _∈_ _A_ and equipment type _v_ _∈_ _V_ _a_ . A commodity volume allocation


plan can be obtained by solving the following set of equations:

### ∑ x ˆ [k] a, v [=] [ q] [k] [,] ∀ k ∈ K, (5a) a ∈ A [k] [ ∑] v ∈ V a ∑ x ˆ [k] a, v [≤] [Q] [v] [(] [ ˆ] [y] [a] [,] [v] [)] [,] ∀ a ∈ A, v ∈ V a, (5b)

_k_ _∈_ _K_ : _a_ _∈_ _A_ _[k]_


_x_ ˆ _[k]_ _a_, _v_ _[≥]_ [0] _∀_ _k_ _∈_ _K_, _a_ _∈_ _A_ _[k]_, _v_ _∈_ _V_ _a_ . (5c)


There is however no guarantee that this set of equations admits a solution given the prediction ˆ _y_ .


The repair layer for the LOLPP learning is a two-step procedure. In the first step, the repair procedure


aims at identifying a small set of outbound terminals for which additional trailers would remove the


infeasibilities. In a second step, the repair procedure minimizes the number of additional trailers required,


while ensuring the feasibility of the resulting load plan.


The first step is a linear program that minimizes capacity violations for the outbound terminals:

### Minimize ˆ ∑ z a, v (6a)

_x_, _z_ _a_ _∈_ _A_, _v_ _∈_ _V_ _a_

### subject to ∑ x ˆ [k] a, v [=] [ q] [k] [,] ∀ k ∈ K, (6b) a ∈ A [k] [ ∑] v ∈ V a ∑ x ˆ [k] a, v [≤] [Q] [v] [(] [ ˆ] [y] [a] [,] [v] [) +] [ z] [a] [,] [v] [,] ∀ a ∈ A, v ∈ V a, (6c)

_k_ _∈_ _K_ : _a_ _∈_ _A_ _[k]_


_x_ ˆ _[k]_ _a_, _v_ [,] _[ z]_ _[a]_ [,] _[v]_ _[≥]_ [0] _∀_ _k_ _∈_ _K_, _a_ _∈_ _A_ _[k]_, _v_ _∈_ _V_ _a_, (6d)


15


The continuous decision variables _z_ _a_, _v_ _≥_ 0 denote the capacity violation on outbound terminal _a_ _∈_ _A_ and


equipment _v_ _∈_ _V_ _a_ . The objective function (6a) minimizes the total capacity violations. Constraints (6b)


ensure that the total volume of every commodity is assigned to its primary and/or alternate outbound


terminal. Constraints (6c) determine the capacity violations for each outbound terminal and equipment


type. Constraints (6d) define the domain and range of variables. If Model 6 has an optimal objective value


equal to 0, then it has found a feasible solution to LOLPP. Otherwise, Model 6 has identified a set of pairs


(outbound terminal, equipment type) for which additional trailer capacity would make it possible to recover


a feasible solution; that is, those with _z_ _[∗]_ _a_, _v_ _[>]_ [ 0 in the optimal solution] **[ z]** _[∗]_ [.]


The second step solves a MIP model to produce a feasible solution to the LOLPP. The key idea of the MIP


model is to allow additional trailer capacity where capacity violations have been detected, while keeping


the remaining feasible predicted loads unchanged. This should reduce significantly the size of the MIP


model, making the repair step much more efficient than the LOLPP model. Let _z_ _[∗]_ be the optimal solution


of Model (6) and define


_AV_ = _{_ ( _a_, _v_ ) _|_ _a_ _∈_ _A_, _v_ _∈_ _V_ _a_ _}_, (7)


_AV_ [+] = _{_ ( _a_, _v_ ) _∈_ _AV_ _|_ _z_ _[∗]_ _a_, _v_ _[>]_ [ 0] _[}]_ [.] (8)


The number of additional units of trailers _ξ_ _a_, _v_ of type _v_ _∈_ _V_ _a_ available to each outbound terminal in _a_ _∈_ _A_


is given by the formula



_ξ_ _a_, _v_ = _z_ _∗_ _a_, _v_
� _Q_ _v_



.
�



Note that adding these capacities are sufficient to find a feasible solution to the LOLPP. The goal of the


MIP model is to determine the best combination of additional capacities to add in order to minimize costs


by leveraging consolidation opportunities. Consider for instance a set of commodities, all of which can be


allocated to terminals _a_ 1 and _a_ 2 and a trailer _v_ with a capacity of 2 units. Suppose the optimal solution


of Model (6) is _z_ _a_ 1, _v_ = _z_ _a_ 2, _v_ = 1. In this case, a feasible OLPP solution to Model (1) can be recovered by


adding two trailers, one for each terminal. However, there exists a LOLPP solution with only one trailer on


any one of the two outbound terminals. This can be found using the second step of the repair procedure,


represented by the following MIP model.

### Minimize u, x ( a, v ) ∑ ∈ AV [+] u a, v (9a) subject to ∑ x [k] a, v [=] [ q] [k] [,] ∀ k ∈ K, (9b) a ∈ A [k] [ ∑] v ∈ V a ∑ x [k] a, v [≤] [Q] [v] [y] [ˆ] [a] [,] [v] [,] ∀ ( a, v ) ∈ AV \ AV [+], (9c)

_k_ _∈_ _K_ : _a_ _∈_ _A_ _[k]_


16


### ∑ x [k] a, v [≤] [Q] [v] [(] [ ˆ] [y] [a] [,] [v] [+] [ u] [a] [,] [v] [)] ∀ ( a, v ) ∈ AV [+], (9d)

_k_ _∈_ _K_ : _a_ _∈_ _A_ _[k]_


_x_ _[k]_ _a_, _v_ [=] [ ˆ] _[x]_ _[k]_ _a_, _v_ _∀_ _k_ _∈_ _K_, ( _a_, _v_ ) _∈_ _AV_ _\_ _AV_ [+], (9e)


_x_ _[k]_ _a_, _v_ _[≥]_ [0] _∀_ _k_ _∈_ _K_, _a_ _∈_ _A_ _[k]_, _v_ _∈_ _V_ _a_, (9f)


_u_ _a_, _v_ _∈{_ 0, . . ., _ξ_ _a_, _v_ _}_ _∀_ ( _a_, _v_ ) _∈_ _AV_ [+] . (9g)


The objective function in (9a) minimizes the additional trailer capacity added on pairs ( _a_, _v_ ) _∈_ _AV_ [+] with


insufficient capacity. Constraints (9b) ensure that the commodity volume is assigned to the primary and/or


alternate terminals. Constraints (9c) and (9d) ensure that the commodity volume allocated to each pair


( _a_, _v_ ) respects the trailer capacities: constraint (9d) have the flexibility of adding additional capacity, while


Constraints (9c) use the trailer predictions. Constraints (9f) and (9g) define the domain and range of


variables. Constraint (9e) can be used to fix the commodity volume allocation to the outbound terminals


with sufficient predicted capacity of trailer type _v_ (i.e., for outbound terminals _AV_ _\_ _AV_ [+] ).


Let _u_ [+] _a_, _v_ [and] _[ x]_ [+] _a_, _v_ [be the optimal solution to model] [ (9)] [. The feasible LOLPP solution returned by the]


repair step is as follows:


_y_ ¯ _a_, _v_ = ˆ _y_ _a_, _v_ + _u_ [+] _a_, _v_ _∀_ ( _a_, _v_ ) _∈_ _AV_ [+] (10a)


_y_ ¯ _a_, _v_ = ˆ _y_ _a_, _v_ _∀_ ( _a_, _v_ ) _∈_ _AV_ _\_ _AV_ [+] (10b)


_x_ ¯ _a_, _v_ = _x_ [+] _a_, _v_ _∀_ ( _a_, _v_ ) _∈_ _AV_ (10c)


It is important to highlight that the number of integer variables in Model (9) is _|_ _AV_ [+] _|_ . Effective machine


learning predictions for the number of trailers of the different types required on each outbound terminal


will result in fewer capacity violations and, hence, fewer integer variables in Model (9). The results in


Section 7.5 compare the average number of integer variables in the repair procedure with the number of


integer variables in Model (1) of OLPP. One of the key benefits of the optimization proxy is that it replaces a


model with a large number of integer decision variables with a prediction model and a MIP model with


significantly fewer variables.


**5.5** **The Training Data**


The machine learning model is trained using a dataset of instances _{_ ( **q** _i_, **y** _i_ ) _}_ _i_ _∈_ _N_, where the inputs **q** _i_ are


collected from historical data. The output **y** _i_ corresponding to **q** _i_ is obtained by solving the LOLPP. As


a result, _the dataset is consistent by design_ and satisfies the field requirements: together all these instances


provide consistent load plans and commodity volume allocation plans. It is useful to mention that, by virtue


of being consistent, this dataset is _easier to learn_ than a dataset where the outputs would be produced by the


17


|Col1|Col2|Col3|Col4|Col5|Col6|Col7|Col8|Col9|
|---|---|---|---|---|---|---|---|---|
|||~~OLP~~<br>LOL|~~P~~<br>P||||||
||||||||||
||||||||||
||||||||||
||||||||||
||||||||||
||||||||||


**Figure 6:** _(color online) The Solution Trajectories of the OLPP and LOLPP on an Industrial Medium-Sized Instance._


OLPP. Consider for instance Figure 6 that depicts approximations, using Piecewise Linear Functions (PLF),


of the solution trajectories of the OLPP and the LOLPP for a given terminal and equipment. It is clear that


the PLF for the LOLPP is much easier to learn than the PLF for the OLPP.


The machine learning model presented earlier is a ReLU-based neural networks that is capable of


learning piecewise linear functions. However, the complexity of learning task depends on the shape of the


PLFs. As the complexity of the piecewise linear function grows with more pieces, a larger neural network


model is required to obtain high-quality approximations.


**Theorem 1.** _(Model Capacity) (Arora et al., 2016) Let_ _f_ : **R** _[d]_ _→_ **R** _be a piecewise linear function with_ _p_ _pieces. If_



1

_f_ _is represented by a ReLU network with depth_ _k_ + 1 _, then it must have size at least_ [1] 2 _[kp]_ _k_ _−_ 1 _. Conversely, any_


_piecewise linear function_ _f_ _that is represented by a ReLU network of depth_ _k_ + 1 _and size at most_ _s_ _, can have at most_



( [2] _k_ _[s]_ [)] _[k]_ _[ pieces.]_


As a consequence, given a fixed-size ReLU network, higher variability of the solution trajectory typically


results in higher approximation errors. Therefore, the use of LOLPP helps circumvent this challenge as it


generates consistent and stable solutions that are easier to learn.

### **6 Greedy Heuristic (GH)**


To provide an additional baseline to evaluate the performance of the optimization proxies, the paper


proposes a greedy heuristic that mimics human planners to construct feasible solutions for OLPP Model


(1) . The greedy heuristic iteratively solves linear programs (LP) until all the _y_ variables are integers, i.e.,


18


they satisfy the integrality tolerance (10 _[−]_ [5] ). During each iteration, the algorithm identifies the fractional


variable with minimum value of ( _⌈_ _y_ _a_, _v_ _⌉−_ _y_ _a_, _v_ ), updates the lower bound of the variable _y_ _a_, _v_ to _⌈_ _y_ _a_, _v_ _⌉_, and


re-solves the LP as shown in Algorithm 1. The main idea is that, for a given outbound terminal _a_ _∈_ _A_ and


trailer type _v_ _∈_ _V_ _a_, if _y_ _a_, _v_ has a fractional value very close to an integer _⌈_ _y_ _a_, _v_ _⌉_, then, this indicates that there


is enough commodity volume to have _at least_ _⌈_ _y_ _a_, _v_ _⌉_ trailers on the arc. The heuristic _greedily_ adjusts the


lower bound of a _y_ variable in each iteration until all _y_ variables can be labeled as integers, in which case a


feasible solution to OLPP has been found.


**Algorithm 1** Greedy Heuristic


1: _**While**_ (True ) _**do**_
2: Solve LP relaxation of Model 1
3: _**If**_ (all _y_ -variables in the LP solution are integers)
4: break


5: _**Else**_
6: ( _a_ _[∗]_, _v_ _[∗]_ ) _←_ argmin ( _a_, _v_ ) ( _⌈_ _y_ _a_, _v_ _⌉−_ _y_ _a_, _v_ )

7: Update the lower-bound of _y_ _a_ _∗_, _v_ _∗_ to _⌈_ _y_ _a_ _∗_, _v_ _∗_ _⌉_
8: _**End If**_
9: _**End While**_

### **7 Computational Study**


This section reports a series of experiments conducted on industrial instances provided by our research


partner. Section 7.1 presents statistics for the problem instances. Section 7.2 discusses the experimental


setting for the optimization models and optimization proxies. Section 7.3 evaluates the computational


performance of the optimization proxies against the greedy heuristic (GH) and the optimization models (the


OLPP and and the LOLPP). Section 7.4 evaluates the benefits of the data generation for learning. Section 7.5


discusses the efficiency of the repair procedure and how it depends on the prediction accuracy.


**7.1** **Instances**


The experiments are based on industrial instances for three different terminals in the service network of


our industry partner: _small_ (S), _medium_ (M), and _large_ (L). Table 1 reports the statistics of the instances with


# _Terminals_ denoting the total number of unique outbound terminals, # _Commodities_ denoting the number of


commodities that are sorted at the terminal and loaded into outbound trailers (rounded to nearest multiple


of 1, 000), and # _Trailers_ denoting the number of planned trailers in the reference plan for the corresponding


terminals (rounded to the nearest multiple of 50); only pup trailers are considered in the experiments. Note


that, in addition to the planned trailers, parcel delivery companies typically operate _empty_ trailers to the


outbound terminals for trailer repositioning. This study only considers trailers that are planned to have


19


**Table 1:** _Data Statistics for Test Instances._

|Category|#Terminals|#Commodities|#Trailers|
|---|---|---|---|
|S<br>M<br>L|92<br>399<br>1,602|9,000<br>15,000<br>20,000|150<br>550<br>2,000|



**Table 2:** _Optimization Model Statistics for Model 1_


Instance #Integer-Vars #Continuous-Vars #Constraints


S 187 50,713 8,962
M 846 60,023 15,583
L 4,475 107,854 24,931


commodity volume and does not include planned empty trailer capacity.


It is worth highlighting that the L instance has more planned capacity than the S and M instances com

bined. Table 2 reports some statistics for Model (1) for the three instances: #Integer-Vars and #Continuous

Vars denote the number of integer and continuous decision variables, respectively, and #Constraints denotes


the total number of constraints.


**7.2** **The Experimental Setting**


**Parameters for the LOLPP** The cost (denoted by _d_ _[k]_ _a_ [) of assigning commodity] _[ k]_ [ to an outbound terminal]

_a_ _∈_ _A_ _[k]_ is defined as



0, if _a_ is the primary outbound terminal for commodity _k_
(11)
_α_ _[k]_ _a_ [+] _[ β]_ _[k]_ [�] otherwise
�



_d_ _[k]_ _a_ [=]







where _α_ _[k]_ _a_ [denotes the distance between terminal] _[ a]_ _[ ∈]_ _[A]_ _[k]_ [ and the final destination of commodity] _[ k]_ _[ ∈]_ _[K]_ [. Recall]


that a commodity _k_ _∈_ _K_ is defined as the set of all packages with the same destination and service class.


The term _α_ _[k]_ _a_ [ensures that two commodities with different final destinations have different flow diversion]


costs from the current terminal to the next outbound terminal. Parameter _β_ _k_ depends on the commodity


service class and ensures that the commodities with the same final destination (and hence, the same value of


_α_ _[k]_ _a_ [) but different service classes (e.g., one-day service, two-day service, or three-days service) have different]


flow diversion costs.


**Data Generation for ML Model** The dataset is generated by perturbing the input parameters of real-life

instances provided by the industry partner with up to 20, 000 commodities. Let **p** _[re f]_ be the volume of

different commodities in a historical plan. The OLPP/LOLPP instances are generated by perturbing **p** _[re f]_ .


20


Namely, for instance _i_, **p** [(] _[i]_ [)] = _γ_ [(] _[i]_ [)] _×_ _η_ [(] _[i]_ [)] _×_ **p** _[re f]_, where _γ_ [(] _[i]_ [)] _∈_ **R** denotes a global scaling factor and _η_ _∈_ **R** _[|]_ _[K]_ _[|]_


is the commodity level multiplicative white noise. The value _γ_ is sampled from a uniform distribution


_U_ [ 80%, 120% ] and, for every commodity, the value _η_ is sampled from a normal distribution with mean


1 and standard deviation of 0.05. For every category, 10, 000 instances are generated, and a commercial


solver is used to solve the OLPP/LOLPP models for each instance. The dataset of 10,000 instances for each


category is then split as follows: 80% for the training set, 10% for the validation set, and 10% for the test set.


**Performance Metrics** The performance metrics in this study are designed to compare the _total trailer_


_capacity_ of the solutions generated by the optimization proxies and the OLPP Model, and the _consistency_


of the solutions generated by the optimization proxies and the LOLPP model. Given an instance **p** with


optimal trailer decisions **y** _[∗]_ and a feasible trailer decision ¯ **y**, the optimality gap is defined as


Gap = ( _Z_ [¯] _−_ _Z_ _[∗]_ ) / _|_ _Z_ _[∗]_ _|_,


where _Z_ _[∗]_ is the optimal trailer capacity of OLPP (Model (1) ), and _Z_ [¯] is the trailer capacity computed from **¯y** .


If the OLPP model cannot be solved to optimality in 30 minutes, then the best lower bound obtained from


the solver run is used to compute the optimality gap instead of _Z_ _[∗]_ .


This paper proposes two metrics to quantify the consistency of a solution. The first metric (∆)



∆ _a_, _v_ =







_|_ _y_ _a_, _v_ _−_ _y_ [ref] _a_, _v_ _[|]_ if _y_ [ref] _a_, _v_ [=] [ 0] _∀_ _a_ _∈_ _A_, _v_ _∈_ _V_ _a_, (12)

_|_ _y_ _a_, _v_ _−_ _y_ [ref] _a_, _v_ _[|]_ [/] _[y]_ [ref] _a_, _v_ [,] otherwise



�



∆ = exp



1
### � | A || V | a [∑] ∈ A v [∑] ∈ V a log ( ∆ a, v + 0.01 )



_−_
1%, (13)



where ∆ is the normalized distance between the trailer decisions in the optimized (load) plan and the


trailer decisions in the reference (load) plan **y** [ref] . It aggregates the distances using a shifted geometric mean


in order to reduce the influence of extreme values or outliers. From a planner’s perspective, this metric


captures the deviation of the trailer decisions in the optimized plan with respect to the trailer decisions in


the reference plan. Load plans that require smaller total trailer capacity and are as close as possible to the


reference plan are highly desirable as they reduce the planner’s effort to evaluate and approve the plans.


The second metric is the total variation of the set of trailer decisions in the _N_ instances (for each terminal).

For simplicity, instances are ordered such that ∑ _k_ _∈_ _K_ _q_ _i_ _[k]_ _[≤]_ [∑] _[k]_ _[∈]_ _[K]_ _[ q]_ _i_ _[k]_ + 1 _[∀]_ _[i]_ _[ ∈]_ _[N]_ [. The goal is to analyze the]


variation in trailer decisions for outbound terminals when the total commodity volume is incrementally

increased from ∑ _k_ _∈_ _K_ _q_ 1 _[k]_ [to] [ ∑] _[k]_ _[∈]_ _[K]_ _[q]_ _[k]_ _|_ _N_ _|_ [. Let] _[ {]_ **[y]** _[i]_ _[}]_ _[i]_ _[∈]_ _[N]_ [ denote the set of trailer decisions of instance set] _[ N]_ [. The]


21


total variation is defined as:

### TV ( { y i } i ∈ N ) = ∑ ∥ y i + 1 − y i ∥ 2 .

_i_ _∈_ _N_


The total variation metric captures the sensitivity of the models, i.e., the impact of changes in total commodity


volume on the trailer decisions for different outbound terminals. Lower total variation implies that the


trailer decisions are less sensitive to changes in total commodity volume. Planners are more amenable to


such solutions because fewer (but effective) load plan adjustments reduce the solution evaluation effort.


They are also easier to execute in practice.


The computational efficiency of different models is measured by the training time of optimization


proxies, including the data generation time and the inference time. Unless specified otherwise, the average


metrics on the test dataset are reported in shifted geometric means to reduce the effect of outliers. For a


performance metric vector _{_ _w_ _}_ _i_ _[n]_ = 1 [the shifted geometric mean] _[ µ]_ _[s]_ [(] _[w]_ [1] [,] _[ · · ·]_ [,] _[ w]_ _[n]_ [)] [ is defined as:]



�



_µ_ _s_ ( _w_ 1, . . ., _w_ _n_ ) = exp



1

_n_
�



_n_
### ∑ log ( w i + s )

_i_ = 1



_−_ _s_,



where _s_ denotes the shift. The experiments use _s_ = 0.01 for the optimality gap and normalized distance


metrics, _s_ = 1 second for the inference/solving time, and _s_ = 1 for the distance between trailer decisions in


the optimized plan and in the reference plan.


**Implementation Details** All optimization models were coded in Python 3.9 using Gurobi 9.5 (Gurobi


Optimization, LLC, 2023) as the MIP solver with 8 CPU threads and default parameter settings, except for


_MIPFocus_ which is set to a value of 3. All deep learning models are implemented using PyTorch (Paszke


et al., 2019) and trained using the Adam optimizer (Kingma and Ba, 2014). The ML models are multiple


layer perceptron and are hyperparameter-tuned using a grid search with learning rate in _{_ 10 _[−]_ [1], 10 _[−]_ [2] _}_,


number of layers in _{_ 3, 4, 5 _}_, and hidden dimension in _{_ 128, 256 _}_ . For each system, the best model is


selected on the validation set and the performances on the test set are reported. Experiments are conducted


on dual Intel Xeon 6226@2.7GHz machines running Linux, on the PACE Phoenix cluster (PACE, 2017). The


training of ML models is performed on Tesla V100-PCIE GPUs with 16GBs HBM2 RAM.


**7.3** **Computational Performance of the Optimization Proxies**


This section presents numerical experiments used to assess the performance of the proposed optimization


proxies (henceforth referred to as _Proxies_ ) against the optimization models and the greedy heuristic ( _GH_ ).


**Optimality Gap** Table 3 presents the optimality gaps of various approaches, including the results of the


OLPP under various computational time limits. In the table, the columns under OLPP report the optimality


22


**Table 3:** _Optimality Gap (%) with respect to the Total Trailer Capacity_


OLPP GH Proxies
Instance

1s 5s 10s 30s 60s 1800s Gap Time (s) Gap Time (s)


S 2.59 0.55 0.48 0.48 0.48 0.48 3.84 3.12 1.14 0.33

M 51.15 5.22 2.18 1.71 1.41 1.39 12.85 13.28 3.80 1.10

L 77.35 14.02 10.41 2.93 2.07 0.93 17.01 121.55 5.21 2.49


**Table 4:** _Normalized Distance (%) to Reference Load Plan_


OLPP (∆) LOLPP GH Proxies
Instance

1s 5s 10s 60s 1800s ∆ t (s) ∆ t (s) ∆ t (s)


S 13.53 13.43 13.42 13.19 13.20 5.18 3600 14.39 3.12 5.19 0.33


M 18.19 13.31 12.69 12.76 12.69 4.01 3600 17.07 13.28 3.75 1.10


L 21.86 7.99 7.96 7.47 7.23 3.52 3600 10.08 121.55 2.97 2.49


**Table 5:** _Total Variation of Load or Trailer Decisions_

|Instance|OLPP (TV) LOLPP GH Proxies 1s 5s 10s 60s 1800s TV t (s) TV t (s) TV t (s)|
|---|---|
|S|2097<br>2063<br>2126<br>2040<br>2054<br>392<br>3600<br>2444<br>3.12<br>115<br>0.33|
|M|2655<br>3275<br>2961<br>3134<br>3174<br>1201<br>3600<br>4797<br>13.28<br>347<br>1.10|
|L|6428<br>9174<br>8228<br>6914<br>7047<br>5228<br>3600<br>11843<br>121.55<br>565<br>2.49|



gaps of the OLPP model with different computational time limits. Columns _Gap_ and _Time(s)_ under _GH_


and _Proxies_ report the optimality gaps of their feasible solutions and the required computational times, in


seconds.


Recall that the OLPP model produces solutions that exhibit considerable variability when the total


commodity volume is perturbed; this observation is shown in Table 4 and 5. As such, it is unlikely to be


practical in scenarios with planners in the loop. Hence, Table 3 compares the optimization proxies and the


greedy heuristic with what should be considered as an “idealized” benchmark. With this caveat in place,


observe the performance of the optimization proxies under tight time constraints: the proxies generate


solutions with low optimality gaps and they are up to 10 to 50 times faster than GH, and around 10 times


faster than the OLPP model solved with Gurobi. Second, although the OLPP model produces solutions


with low optimality gaps, closing the optimality gap proves to be a significant challenge due to the poor LP


relaxation. The performance of GH is also impeded by the inefficiencies of the LP relaxation, as it solves


the LP relaxations over many iterations; it takes GH around 30 iterations for terminal S, 200 iterations for


terminal M, and more than 1000 iterations for terminal L to generate a feasible solution.


23


**Consistency** Tables 4 and 5 report the consistency of solutions obtained from different models in terms


of the normalized distance to the reference load plan and the total variation of the generated solutions.


When optimizing the LOLPP, the experiments set a time limit of 1,800 seconds on the first sub-objective.


The best primal bound is then used for the optimization of the last two sub-objectives with a time limit


of 1,800 seconds again. This second optimization optimizes a weighted function of the second and third


sub-objective where the second sub-objective has a weight of 1 and the third sub-objective has a small


weight _ϵ_, i.e.,


1
_ϵ_ =
~~�~~ max _k_ _∈_ _K_, _a_ _∈_ _A_ _k_ _d_ _[k]_ _a_ ~~�~~ ∑ _k_ _∈_ _K_ _q_ _[k]_ [.]


and minimizes the objective

### ∑ | y a, v − γ a, v | + ϵ ∑ d [k] a [x] [k] a, v a ∈ A v [∑] ∈ V a k ∈ K a ∈ [∑] A k v [∑] ∈ V a


_The high-level result is that proxies are ideally suited to produce consistent plans._ Table 4 shows that the proxies


accurately predict, in a few seconds, the results produced by LOLPP after an hour. Furthermore, Table 5


shows that proxies produce solutions that have at least an order of magnitude smaller total variations in


trailer decisions than both LOLPP and GH. Proxies produce load plans that exhibit greater stability when


the total commodity volume changes for the given terminal.


The fact that proxies improve the consistency of the LOLPP plans is especially interesting: it means that


the optimization proxies, by virtue of the learning step, avoid oscillations present in the LOLPP approach.


Of course, it does so at a small loss in objective value (if, for instance, the LOLPP model is allowed a minute


to run instead of the 2.5 seconds of the optimizations). However, the consistency benefits as shown in


Table 5 are substantial and important for practical implementation. The proxies also provide dramatic


improvements over GH.


**7.4** **Illustrating the Variations in Trailer Capacities**


As discussed in Section 4, the optimal (or near-optimal) trailer decisions of the OLPP are very sensitive to


changes in total commodity volume due to the presence of symmetries in the model. Figure 7 compares the


variations in trailer decisions on 9 different outbound terminals from the given terminal in the best feasible


solutions obtained from the OLPP, the LOLPP, and the optimization proxy in the small (S) instance.


The dramatic variation in trailer decisions on an terminal in the OLPP solutions is not desirable in


environments with planners in the loop, where similar solutions are expected for similar instances. The


LOLPP approach is much more consistent, and its solutions are shown in _orange_ in the plots of Figure 7. As


24


**Figure 7:** _(color online) Illustration of the sensitivity of trailer decisions to changes in total commodity volume on different terminals_
_for small (S) instances. Trailer decisions of the OLPP are very sensitive to changes in total commodity volume, whereas_
_the LOLPP generates consistent load plans. The proxy learns the LOLPP solution patterns and produces consistent_
_solutions._


shown in _blue_ plot, the optimization proxy is effective in producing solutions that are close to the solutions


generated by LOLPP. It should be highlighted that the LOLPP approach has two benefits. First, it generates


consistent solutions that are amenable to planner-in-the-loop environments. Second, it makes the learning


problem much more tractable since designing a proxy for the OLPP is really challenging due to the inherent


symmetry in the solution space and the sensitivity of the model to minor changes in commodity volume.


**7.5** **Accuracy of the ML Predictions and Efficiency of the Repair Procedure**


Figure 8 shows the distribution of the predicted trailer capacity as a percentage of the total trailer capacity


in the feasible solution generated by the proxies for each instance. The trailer capacity predicted by the


machine learning model on each terminal is very close to a feasible solution: only a few trailers must be


added to a small set of outbound terminals to recover a feasible solution. Indeed, the results show that more


than 98% of the trailer capacity is predicted correctly and less than 2% comes from the repair procedure.


One of the key benefits of the optimization proxy is that it replaces a model with a large number of


25


**Figure 8:** _The Proportion of the Total Trailer Capacity in the Final Solution Fixed by the Proxies._


Instance OLPP (Model 1) Repair Procedure (Model 9)


S 187 1.3

M 846 19.5

L 4,475 35.5


**Table 6:** _Comparing the number of integer decision variables in the OLPP, i.e., Model 1, with the average number of integer_
_decision variables in the Repair Procedure, i.e., Model 9._


integer decision variables with a prediction model and a relatively simpler MIP model with a smaller


number of integer variables. Table 6 compares the number of integer decision variables in the OLPP (Model


1) and the average number of integer decision variables in the repair procedure (Model 9) across 1000 test


instances.


The number of integer decision variables remains the same for each test instance in an instance category


because it depends on the number of outbound terminals and trailer types; only the commodity volume


changes across different test instances. However, the size of the MIP Model (9) in the repair procedure


depends on the predictions of the machine learning model; the number of integer decision variables in the


model is equal to the number of outbound terminals with a capacity violation, which is determined by


Model (6). As the predictions can vary for different test instances with the same set of outbound terminals


due to different commodity volumes, the number of integer variables in Model (9) can be different for


different test instances; Table 6 reports the average number of integer variables in Model 9 for the repair


procedure over all test instances. The main observation here is that the repair procedure is efficient because


it has a small number of integer decision variables, on average, due to the accurate predictions from the


machine learning model.


26


### **8 The Benefits of Optimization and Learning**

The results in the paper also make it possible to evaluate the benefits of optimization compared to human


planners. In practice, planners assign commodities to their primary terminals, then a first alternate


terminal (based on their experience), then a second alternate terminal, and so on; planners may also


prioritize alternate terminals closest to their terminal. This is a _greedy_ approach that is myopic in nature.


A comparison between such a greedy approach and the optimization models helps assess the value of


optimization. Of course, the optimization models are too slow to be used with planners in the loop. _The_


_optimization proxies proposed in the paper are the technology enablers for translating the benefits of optimization into_


_practice._


Figure 9 presents the benefits of the load planning methodology. It compares the variation in total trailer


capacity required to contain the total commodity volume (blue curve) and the total volume allocated to


alternate terminals (green curve) across four different load plans: _Primary Only_, _Reference Plan_, _1-Alt_ and


_All-Alt_ for the three instance categories. In the _Primary Only_ plan, each commodity can be assigned only


to its primary terminal. The _Reference Plan_, referred to as the _P-Plan_, is the reference load plan from our


industry partner. The _P-Plan_ is produced by the planners using the greedy approach described earlier in


this section, and each commodity in the plan can use any number of compatible alternate terminals. In the


_1-Alt_ plan, each commodity can be assigned to either its primary terminal and/or the cheapest alternate

terminal; here, cheapest implies that the alternate terminal _a_ has minimum flow diversion cost ( _d_ _[k]_ _a_ [) for the]


commodity _k_ . In the _All-Alt_ plan, each commodity can be assigned to the primary and all the available


alternate terminals. Observe that the curves in Figure 9 are on different scales: the left y-axis is for the blue


curve, and the right y-axis is for the green curve.


Figure 9 demonstrates a consistent trend in capacity required in the four different load plans: the capacity


monotonically decreases, and the decreases are significant. Allowing to split the commodity volume across


the primary and alternate terminals improves trailer consolidation. These benefits are already apparent in


the _P-Plan_ of the planners, despite the fact that the _P-Plan_ follows a greedy approach. The optimization


model corresponding to the _1-Alt_ plan, brings another step change in consolidation, highlighting the benefits


of optimization. This benefit stems from the fact that a large number of commodities have at least one


alternate terminal in all instances (see Figure 10, which highlights the percentage of commodities with a


specific number of alternate terminals for the three instances). Note also that the _1-Alt_ load plan requires a


significantly smaller total trailer capacity than the _P-Plan_, although the _P-Plan_ has the flexibility of using


any number of alternate terminals; this is because in the _P-Plan_ planners use a greedy approach to allocate


commodity volume to compatible terminals. The _All-Alt_ plan brings further benefits, but they are rather


incremental. Part of the reason comes from the fact that a relatively small fraction of the commodities have


more than one alternate terminal. It would be interesting to study a network with more flexibility as this


27


**(a)** _Instance S_



**(b)** _Instance M_













**(c)** _Instance L_


**Figure 9:** _Variation in total trailer capacity and total volume allocated to alternate terminals in four load plans._


**Figure 10:** _(color online) Instance Statistics About the Range of Alternate Terminals For Commodities._


may bring further load consolidation benefits.


Figure 11 compares the percentage of the total commodity volume that is assigned to the alternate


28


|Col1|Col2|
|---|---|
|||


|Col1|Col2|
|---|---|
|||


|Col1|Col2|
|---|---|
|||





**Figure 11:** _(color online) Proportion of total commodity volume allocated to alternate terminals in the P-Plan and All-Alt Plan_


terminals in the _P-Plan_ and the _All-Alt_ plan. It could be undesirable to allocate a major proportion of the


volume to the alternate terminals because the downstream buildings may not be better equipped to handle


or process the large inbound volume. Observe that, on average across all the instances, the _All-Alt_ plan (resp.


_P-Plan_ ) allocates around 17% (resp. 9%) commodity volume on the alternate terminals. The _All-Alt_ plan


reduces the total trailer capacity by roughly 12% _−_ 15% relative to the _P-Plan_ . For the L instance, there is a


significant gap between the _P-Plan_ and _All-Alt_ plan statistics because most of the commodities in the _P-Plan_


are allocated to the primary terminals. This is why the total commodity volume allocated to the alternate


terminals in the _P-Plan_ and the _Primary Only_ have a small difference; see Figure 9c for the L category.


These results show that optimization proxies can bring substantial benefits in practice. They provide, in


real-time, significant improvements over the existing planning process. Moreover, by virtue of their training,


they approximate the LOLPP optimization and make sure that plans evolve smoothly during the planning


process: small changes in inputs will not result in large changes in the proposed solutions.


_These results are eminently practical_ . One of the challenges in the operational setting is the need for


additional trailers when the total commodity volume increases. Based on the planner’s recommendation,


the scheduling team can acquire these trailers either through empty trailer repositioning or by engaging in


short-term trailer leasing with local companies. Conversely, if the commodity volume decreases, planners are


left with a plan that has low trailer utilization. The optimization proxies address this issue directly. Planners


can also use the proposed optimization proxies to obtain recommendations for load plan adjustment within


a matter of seconds in the event of a disruption (due to uncertainty in commodity volume), even for the


largest terminal. Furthermore, the recommendations from the optimization proxies are consistent with


existing load plans, which makes it easy for the planners to evaluate and implement the suggestions. Finally,


29


new terminals in the service network often do not have dedicated planners to develop and/or update


existing load plans when commodity volume changes, and extra capacity is built in the system to handle


the commodity volume in the worst-case scenario. Optimization proxies can be used as a decision-support


tool at such terminals.

### **9 Conclusions and Future Work**


This paper studies the Outbound Load Planning Problem (OLPP), which produces a load and a volume


allocation plan for the commodities processed at an individual terminal in a parcel service network. The


OLPP is intended to be solved by planners regularly in the two weeks preceeding the day of operations.


The paper was motivated by the need of an industrial partner for a decision-support tool to advise planners


in achieving better commodity volume consolidation and decreasing trailer costs.


The paper proposed a MIP model for the OLPP: experimental results however revealed that the solutions


of the OLPP, when solved by commercial solvers, exhibit significant variations when commodity volume


varies. This makes the model impractical for industrial use, i.e., with planners in the loop. To remedy this


drawback, the paper proposed the LOLPP, a lexicographic optimization model that breaks the symmetries


of the OLPP by minimizing the distance to a reference plan and the costs of diverting flows from a primary


outbound terminal (i.e., the desired terminal chosen by default at the network level).


Although the LOLPP eliminates the instability of the OLPP and produces consistent plans that can be


used by planners, it cannot be used in practice, as it does not meet the real-time constraints imposed by the


planner interactions. To address this computational challenge, the paper proposed the use of optimization


proxies that approximate the LOLPP through a combination of a machine learning model and a repair


procedure that restores the feasibility of the machine learning predictions. The paper presented the machine


learning model which only predicts the number of trailers for each outbound terminal, and the repair


procedure that adjusts the number of trailers and computes the allocation of commodity volume to the


outbound terminals. The resulting optimization proxies were able to deliver high-quality solutions in a


fraction of the time taken by the LOLPP. An extensive computational study on industrial instances shows


that the optimization proxy is around 10 times faster than the commercial solver in obtaining the same


quality solutions and orders of magnitude faster for generating solutions that are consistent with each other.


The proposed approach also highlights the benefits of the LOLPP for load consolidation, as well as the


significant savings that result from the combination of machine learning and optimization.


This research is the first stage of a multi-stage project with our industry partner. Future research


directions include extending the proposed approach to clusters of terminals, taking into account their


capacities for processing commodities while tapping into the computational efficiency of the current


terminal-specific optimization proxies. The resulting problem thus requires determining both inbound


30


and outbound planning decisions at each terminal, which significantly complicates the optimization and


learning models.

### **Acknowledgement**


This research was partly supported by the NSF AI Institute for Advances in Optimization (Award 2112533).

### **References**


Arora, R., Basu, A., Mianjy, P., & Mukherjee, A. (2016). Understanding deep neural networks with rectified


linear units. _arXiv preprint arXiv:1611.01491_ .


Bakir, I., Erera, A., & Savelsbergh, M. (2021). Motor carrier service network design. In _Network design with_


_applications to transportation and logistics_ (pp. 427–467). Springer.


Baubaid, A., Boland, N., & Savelsbergh, M. (2021). The value of limited flexibility in service network designs.


_Transportation Science_, _55_ (1), 52–74.


Baubaid, A., Boland, N., & Savelsbergh, M. (2023). The dynamic freight routing problem for less-than

truckload carriers. _Transportation Science_, _57_ (3), 717–740.


Bengio, Y., Lodi, A., & Prouvost, A. (2021). Machine learning for combinatorial optimization: A methodolog

ical tour d’horizon. _European Journal of Operational Research_, _290_ (2), 405–421.


Boland, N., Hewitt, M., Marshall, L., & Savelsbergh, M. (2017). The continuous-time service network design


problem. _Operations research_, _65_ (5), 1303–1321.


Chatzos, M., Mak, T. W. K., & Van Hentenryck, P. (2022). Spatial network decomposition for fast and scalable


ac-opf learning. _IEEE Transactions on Power Systems_, _37_ [(4), 2601–2612. https://doi.org/10.1109/](https://doi.org/10.1109/TPWRS.2021.3124726)


[TPWRS.2021.3124726](https://doi.org/10.1109/TPWRS.2021.3124726)


Chen, W., Khir, R., & Van Hentenryck, P. (2023). Two-stage learning for the flexible job shop scheduling


problem. _arXiv preprint arXiv:2301.09703_ .


Chen, W., Park, S., Tanneau, M., & Van Hentenryck, P. (2022). Learning optimization proxies for large

scale security-constrained economic dispatch. _Electric Power Systems Research_, _213_ [, 108566. https:](https://doi.org/https://doi.org/10.1016/j.epsr.2022.108566)


[//doi.org/https://doi.org/10.1016/j.epsr.2022.108566](https://doi.org/https://doi.org/10.1016/j.epsr.2022.108566)


Chen, W., Tanneau, M., & Van Hentenryck, P. (2024). End-to-end feasible optimization proxies for large-scale


economic dispatch. _IEEE Transactions on Power Systems_, _39_ [(2), 4723–4734. https://doi.org/10.1109/](https://doi.org/10.1109/TPWRS.2023.3317352)


[TPWRS.2023.3317352](https://doi.org/10.1109/TPWRS.2023.3317352)


Crainic, T. G., & Laporte, G. (1997). Planning models for freight transportation. _European journal of operational_


_research_, _97_ (3), 409–438.


Csirik, J. (1991). Heuristics for the 0-1 min-knapsack problem. _Acta Cybernetica_, _10_ (1-2), 15–20.


31


Erera, A., Hewitt, M., Savelsbergh, M., & Zhang, Y. (2013). Improved load plan design through integer


programming based local search. _Transportation Science_, _47_ (3), 412–427.


Fioretto, F., Mak, T. W. K., & Hentenryck, P. V. (2020). Predicting AC optimal power flows: Combining deep


learning and lagrangian dual methods. _The Thirty-Fourth AAAI Conference on Artificial Intelligence,_


_AAAI 2020, The Thirty-Second Innovative Applications of Artificial Intelligence Conference, IAAI 2020,_


_The Tenth AAAI Symposium on Educational Advances in Artificial Intelligence, EAAI 2020, New York, NY,_


_USA, February 7-12, 2020_ [, 630–637. https://ojs.aaai.org/index.php/AAAI/article/view/5403](https://ojs.aaai.org/index.php/AAAI/article/view/5403)


Friesen, D. K., & Langston, M. A. (1986). Variable sized bin packing. _SIAM journal on computing_, _15_ (1),


222–230.


    -     Fu, Z. H., Qiu, K. B., & Zha, H. (2021). Generalize a small pre-trained model to arbitrarily large tsp instances.


_Proceedings of the AAAI Conference on Artificial Intelligence_, _35_ (8), 7474–7482.


[Gurobi Optimization, LLC. (2023). Gurobi Optimizer Reference Manual. https://www.gurobi.com](https://www.gurobi.com)


Herszterg, I., Ridouane, Y., Boland, N., Erera, A., & Savelsbergh, M. (2022). Near real-time loadplan


adjustments for less-than-truckload carriers. _European Journal of Operational Research_, _301_ (3), 1021–


1034.


Hewitt, M. (2019). Enhanced dynamic discretization discovery for the continuous time load plan design


problem. _Transportation science_, _53_ (6), 1731–1750.


Ioffe, S., & Szegedy, C. (2015). Batch normalization: Accelerating deep network training by reducing internal


covariate shift. _International conference on machine learning_, 448–456.


Karp, R. M. (2010). _Reducibility among combinatorial problems_ . Springer.


Khalil, E., Dai, H., Zhang, Y., Dilkina, B., & Song, L. (2017). Learning combinatorial optimization algorithms


over graphs. _Advances in neural information processing systems_, _30_ .


Kingma, D. P., & Ba, J. (2014). Adam: A method for stochastic optimization. _arXiv preprint arXiv:1412.6980_ .


Kool, W., Van Hoof, H., & Welling, M. (2018). Attention, learn to solve routing problems! _arXiv preprint_


_arXiv:1803.08475_ .


Kotary, J., Fioretto, F., & Van Hentenryck, P. (2021). Learning hard optimization problems: A data generation


perspective. _Advances in Neural Information Processing Systems_, _34_, 24981–24992.


Kotary, J., Fioretto, F., & Van Hentenryck, P. (2022). Fast approximations for job shop scheduling: A


lagrangian dual deep learning method. _Proceedings of the AAAI Conference on Artificial Intelligence_,


_36_ (7), 7239–7246.


Kotary, J., Fioretto, F., Van Hentenryck, P., & Wilder, B. (2021). End-to-end constrained optimization learning:


A survey. _arXiv preprint arXiv:2103.16378_ .


Lindsey, K., Erera, A., & Savelsbergh, M. (2016). Improved integer programming-based neighborhood search


for less-than-truckload load plan design. _Transportation science_, _50_ (4), 1360–1379.


32


Marshall, L., Boland, N., Savelsbergh, M., & Hewitt, M. (2021). Interval-based dynamic discretization


discovery for solving the continuous-time service network design problem. _Transportation science_,


_55_ (1), 29–51.


PACE. (2017). _Partnership for an Advanced Computing Environment (PACE)_ [. http://www.pace.gatech.edu](http://www.pace.gatech.edu)


Park, S., Chen, W., Han, D., Tanneau, M., & Van Hentenryck, P. (2022). Confidence-aware graph neural


networks for learning reliability assessment commitments. _arXiv preprint arXiv:2211.15755_ .


Park, S., & Van Hentenryck, P. (2023). Self-supervised primal-dual learning for constrained optimization.


_Proceedings of the 37th AAAI Conference on Artificial Intelligence, Washington, DC_ .


Paszke, A., Gross, S., Massa, F., Lerer, A., Bradbury, J., Chanan, G., Killeen, T., Lin, Z., Gimelshein, N.,


Antiga, L., et al. (2019). Pytorch: An imperative style, high-performance deep learning library.


_Advances in neural information processing systems_, _32_ .


Powell, W. B. (1986). A local improvement heuristic for the design of less-than-truckload motor carrier


networks. _Transportation Science_, _20_ (4), 246–257.


Rumelhart, D. E., Hinton, G. E., & Williams, R. J. (1986). Learning representations by back-propagating


errors. _nature_, _323_ (6088), 533–536.


Song, W., Chen, X., Li, Q., & Cao, Z. (2022). Flexible job-shop scheduling via graph neural network and


deep reinforcement learning. _IEEE Transactions on Industrial Informatics_, _19_ (2), 1600–1610.


Srivastava, N., Hinton, G., Krizhevsky, A., Sutskever, I., & Salakhutdinov, R. (2014). Dropout: A simple way


to prevent neural networks from overfitting. _The journal of machine learning research_, _15_ (1), 1929–1958.


[Stanley, M. (2022). https://www.morganstanley.com/ideas/global-ecommerce-growth-forecast-2022](https://www.morganstanley.com/ideas/global-ecommerce-growth-forecast-2022)


Ulch, D. (2022). _Greedy approaches for large-scale flow and load planning_ [Doctoral dissertation, Georgia Institute


of Technology].


Van Hentenryck, P. (n.d.). Fusing artificial intelligence and optimization with trustworthy optimization


[proxies. https://sinews.siam.org/Details-Page/fusing-artificial-intelligence-and-optimization-](https://sinews.siam.org/Details-Page/fusing-artificial-intelligence-and-optimization-with-trustworthy-optimization-proxies)


[with-trustworthy-optimization-proxies](https://sinews.siam.org/Details-Page/fusing-artificial-intelligence-and-optimization-with-trustworthy-optimization-proxies)


Yuan, E., Chen, W., & Van Hentenryck, P. (2022). Reinforcement learning from optimization proxy for


ride-hailing vehicle relocation. _Journal of Artificial Intelligence Research_, _75_, 985–1002.


33


### **10 Appendix**

**10.1** **Example for Compatible Primary and Alternate Terminals for Commodities from**


**a Terminal with Multiple Sorts**


In this section, we present an example to illustrate the construction of set _A_ _[k]_ for a commodity _k_ _∈_ _K_ when

OLPP considers multiple sorts at a terminal on a specific day. We define _A_ _[k]_ to denote the set of primary

and alternate arcs ( _o_ _a_, _d_ [ˆ] _a_ ) such that commodity _k_ is processed at terminal-sort pair _o_ _a_ and loaded into a

trailer planned for outbound terminal-sort pair _d_ [ˆ] _a_ . Figure 12a shows an example where there are two sorts


at terminal A on day 1: sort 1 and sort 2. Suppose the nodes of terminals B, D, and F denote a specific


sort ˆ _s_ at the respective terminals. One unit of a commodity destined for terminal D on day 4 is processed


at terminal A in sort 2; the commodity has a primary arc to terminal F on day 3 and an alternate arc to


terminal B on day 3. A commodity with four units is processed at terminal A in sort 1 and has a primary


arc to its ultimate destination terminal B on day 3. Note that if we restrict the volume of a commodity to be


assigned only to its primary and alternate arcs, two trailers are required. However, in practice, as shown


in Figure 12b, a trailer is opened (for loading) at terminal A in sort 1, and the four units of commodity B


are loaded into the trailer. As the trailer has available space, it is kept open till sort 2, where one unit of


commodity D is loaded into the trailer. Finally, the trailer transports the commodities to terminal B on day 3;


as a result, only one trailer is required because both the commodities are consolidated into the same trailer


by keeping the trailer waiting from sort 1 to sort 2. It is important to note that consolidation is possible


because the departures from sort 1 and sort 2 from terminal A are planned to arrive at the same destination

node at terminal B. To allow such consolidations in the OLPP model, we define _A_ _[k]_ for commodity _k_ = _D_ to


include the arc ( _A_, _sort_ 1, _Day_ 1 ) _→_ ( _B_, ˆ _s_, _Day_ 3 ) . More formally, for any commodity _k_ _∈_ _K_ with a primary

and alternate arc set _A_ _[k]_ we include arcs _a_ _[′]_ = ( _o_ _a_ _′_, _d_ [ˆ] _a_ _′_ ) in _A_ _[k]_ if and only if there exists an arc ( _o_ _a_, _d_ [ˆ] _a_ ) _∈_ _A_ _[k]_

such that the sort of node _o_ _a_ _′_ is earlier (in time) than sort of node _o_ _a_ and _d_ [ˆ] _a_ = _d_ [ˆ] _a_ _′_ .


**10.2** **Complexity Results**


Model 1 is difficult to solve because in addition to determining the right combination of trailer types to


contain volume assigned to each outbound terminal, we need to determine the right splits of commodity


volume for the given set of outbound terminals. We will analyze the complexity of Model 1 using the


special cases described below.


_**Case 1:**_ There is only one trailer type available at the terminal, i.e., _|_ _V_ _a_ _|_ = 1 _∀_ _a_ _∈_ _A_ . Each commodity

_k_ _∈_ _K_ is compatible with exactly one outbound terminal _a_ _k_, i.e., _A_ _[k]_ = _{_ _a_ _k_ _} ∀_ _k_ _∈_ _K_


_**Case 2:**_ There is only one trailer type available at the terminal, i.e., _|_ _V_ _a_ _|_ = 1 _∀_ _a_ _∈_ _A_ . Each commodity

_k_ _∈_ _K_ is compatible with all outbound terminals, i.e., _A_ _[k]_ = _A_ _∀_ _k_ _∈_ _K_


34


_̸_



_̸_


**(b)** _better consolidation_


_̸_



_̸_



_̸_



A, Sort 1,


Day 1


_̸_



_̸_


**(a)** _base case_


_̸_



_̸_



A, Sort 1,


Day 1


_̸_



_̸_



**Figure 12:** _Example figure to illustrate the additional consolidation opportunities arising from delaying a trailer from one sort to_
_another sort at the same terminal_


**Proposition 2.** _Cases_ 1 _and_ 2 _are polynomial time solvable_


_Proof._ In _Case_ 1, the volume of each commodity _k_ is assigned to its only outbound terminal, _a_ _k_, i.e. _x_ _[k]_ _a_ _k_ [=] _[ q]_ _[k]_ [.]


_̸_



Then, the optimal solution has _y_ _a_ = ∑ _k_ _∈_ _K_ : _Q_ _a_ _∈_ _Ak_ _x_ _[k]_ _a_
�


_̸_



= ∑ _k_ _∈_ _K_ : _Q_ _a_ _∈_ _Ak_ _q_ _[k]_
� �


_̸_



_∀_ _a_ _∈_ _A_ .
�


_̸_



In _Case_ 2, the optimal solution is to assign the volume of all commodities on any arc _a_ _∈_ _A_ and set

_x_ _[k]_ _a_ [=] _[ q]_ _[k]_ _[ ∀]_ _[k]_ _[ ∈]_ _[K]_ [,] _[ y]_ _[a]_ [=] � ∑ _k_ _∈_ _Q_ _K_ _q_ _[k]_ �, _y_ _a_ _′_ = 0 _∀_ _a_ _[′]_ _∈_ _A_, _a_ _[′]_ _̸_ = _a_ .


_**Case 3:**_ Same as _Case 1_, but with more than one trailer type available at the terminal


_**Case 4:**_ Same as _Case 2_, but with more than one trailer type available at the terminal


**Proposition 3.** _Cases_ 3 _and_ 4 _are weakly NP-Hard_


_Proof._ In the optimal solution in _Case_ 3, the volume of each commodity _k_ is assigned to its only outbound


terminal _a_ _k_ . Thus, it remains to decide the optimal combination of trailer types required to containerize the


volume assigned to every outbound terminal. This is the minimum knapsack problem (see Csirik, 1991 for


the problem definition) for each outbound terminal (that has more than one trailer type) as shown in 14,


which is known to be weakly NP-Hard.

### For every a ∈ A : Minimize ∑ c v y a, v (14a)

_y_ _v_ _∈_ _V_ _a_

### subject to ∑ q [k] ≤ ∑ Q v ( y a, v ), (14b)

_k_ _∈_ _K_ : _a_ _∈_ _A_ _[k]_ _v_ _∈_ _V_ _a_


_y_ _a_, _v_ _∈_ **Z** _≥_ 0 _∀_ _v_ _∈_ _V_ _a_ (14c)


Similarly, for _Case_ 4, there exists an optimal solution in which the volume of all commodities is assigned

to one outbound terminal _a_ _[∗]_ _∈_ _A_, i.e., _x_ _[k]_ _a_ _[∗]_ [=] _[ q]_ _[k]_ _[ ∀]_ _[k]_ _[ ∈]_ _[K]_ [ and it remains to solve a minimum knapsack]


35


problem for the outbound terminal _a_ _[∗]_ due to which _Case_ 4 is weakly NP-Hard.


_**Case 5:**_ Each commodity _k_ _∈_ _K_ is compatible with a subset of outbound terminals, i.e., _A_ _[k]_ _⊂_ _A_, and

has unit volume, _q_ _[k]_ = 1. There is only one trailer type with per-unit cost _c_ _a_ = 1 _∀_ _a_ _∈_ _A_ and capacity


_Q_ = max _a_ _∈_ _A_ _{_ ∑ _k_ _∈_ _K_ **1** _a_ _∈_ _A_ _k_ _}_ ; hence, _y_ _a_ _∈{_ 0, 1 _}∀_ _a_ _∈_ _A_, as installing one unit of trailer is sufficient to contain


the total volume that can be assigned to the outbound terminal. Note that we ignore the index _v_ for the


trailer because each outbound terminal has exactly one and the same trailer type.


**Claim 4.** _In the optimal solution of Case 5, each commodity is assigned to exactly one outbound terminal (i.e. there is_


_no splitting of volume)_


_Proof._ We will present a proof by contradiction. WLOG, suppose there exists an optimal solution in

which the volume of a commodity _k_ [ˆ] is split between two outbound terminals and the volume of all other

commodities _k_ _∈_ _K_ _\{_ _k_ [ˆ] _}_ is assigned to exactly one outbound terminal _a_ _k_ . Thus, we have _x_ _[k]_ _a_ _k_ [=] _[ q]_ _[k]_ _[ ∀]_ _[k]_ _[ ∈]_ _[K]_ _[\{]_ _[k]_ [ˆ] _[}]_

and _x_ _[k]_ _a_ [ˆ] 1 [+] _[ x]_ _[k]_ _a_ [ˆ] 2 [=] _[ q]_ _[k]_ [. Consider a solution] [x] _[k]_ _a_ [=] _[ x]_ _[k]_ _a_ _[∀]_ _[k]_ _[ ∈]_ _[K]_ _[\{]_ _[k]_ [ˆ] _[}]_ [ and] [x] _[k]_ _a_ [ˆ] 1 [=] _[ x]_ _[k]_ _a_ [ˆ] 1 [+] _[ ϵ]_ [,] [x] _[k]_ _a_ [ˆ] 2 [=] _[ x]_ _[k]_ _a_ [ˆ] 2 _[−]_ _[ϵ]_ [, where] _[ ϵ]_ _[ >]_ [ 0]

is a small real number. Note that x _[k]_ _a_ [ˆ] 1 [+] [x] _[k]_ _a_ [ˆ] 2 [=] _[ q]_ [. Consider another solution] [ ¯] _[x]_ _[k]_ _a_ [=] _[ x]_ _[k]_ _a_ _[∀]_ _[k]_ _[ ∈]_ _[K]_ _[\{]_ _[k]_ [ˆ] _[}]_ [ and]

_x_ ¯ _[k]_ _a_ [ˆ] 1 [=] _[ x]_ _[k]_ _a_ [ˆ] 1 _[−]_ _[ϵ]_ [,] [ ¯] _[x]_ _[k]_ _a_ [ˆ] 2 [=] _[ x]_ _[k]_ _a_ [ˆ] 2 [+] _[ ϵ]_ [. Note that both solutions] [x] [and] [ ¯] _[x]_ [ satisfy constraints] [ (1b)] [ and are feasible to]


constraints (1c) because we choose _Q_ = max _a_ _∈_ _A_ _{_ ∑ _k_ _∈_ _K_ **1** _a_ _∈_ _A_ _k_ _}_ . The solution _x_ can be written as a convex



combination of the solution x and ¯ _x_ ( _x_ _[k]_ _a_ [=] [1] 2




[1] 2 _[x]_ [¯] _[k]_ _a_ [+] [1] 2




[1] 2 [x] _[k]_ _a_ _[∀]_ _[k]_ _[ ∈]_ _[K]_ [,] _[ a]_ _[ ∈]_ _[A]_ _[k]_ [) which contradicts the optimality of the]



solution.


**Proposition 5.** _Case 5 is strongly NP-Hard_


_Proof._ We will show that this special case can be solved as a set cover problem, which is known to be


strongly NP-Hard (Karp, 2010). An instance of a set cover is given by a ground set _U_ = _{_ _x_ 1, _x_ 2, _· · ·_, _x_ _n_ _}_


and a collection of _m_ subsets _E_ _i_ _⊆_ _U_ _∀_ _i_ _∈{_ 1, 2, _· · ·_, _m_ _}_ of the ground set _U_ . The optimization problem is to


find the smallest number of subsets _i_ _∈{_ 1, 2, _· · ·_, _m_ _}_ such that [�] _i_ _∈{_ 1,2, _···_, _m_ _}_ _[E]_ _i_ [=] _[ U]_ [.]


From claim 4, we know that each commodity is assigned to exactly one outbound terminal in the


optimal solution. Let commodity _k_ _∈_ _K_ denote element _x_ _k_ _∈_ _U_, _|_ _K_ _|_ = _n_ and set of outbound terminals


_A_ = _{_ 1, 2, _· · ·_, _m_ _}_ . Define _K_ _i_ = _{_ _k_ _∈_ _K_ : _x_ _k_ _∈_ _E_ _i_ _}_ as the set of commodities or elements that can be covered


by selecting outbound terminals _i_ _∈{_ 1, 2, _· · ·_, _m_ _}_ . Now note that finding the smallest number of outbound


terminals _a_ _∈_ _A_ such that all commodities in _K_ are covered is equivalent to finding the smallest number of


subsets _i_ _∈{_ 1, 2, _· · ·_, _m_ _}_ to cover all elements in _U_ .


36


